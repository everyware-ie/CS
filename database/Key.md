# 키(Key)

## 데이터베이스 무결성

- 개체 무결성(Entity Integrity)
    - 기본키를 구성하는 속성은 null 값을 가질 수 없다.
    - 기본키를 구성하는 속성은 다른 레코드와 중복될 수 없다.
- 참조 무결성(Referential Integrity)
    - 외래키를 구성하는 속성은 참조 릴레이션의 기본키 값과 동일해야 한다.
- 도메인 무결성(Domain Integrity)
    - 속성값은 속성이 정의된 도메인의 범위를 벗어날 수 없다.

## 데이터베이스 Key의 개념 및 종류

### Key란?

키는 데이터베이스에서 조건을 만족하는 튜플을 찾거나 순서대로 정렬할 때 다른 튜플들과 구별할 수 있는 유일한 기준이 되는 Attribute(속성)

예를 들어 이름, 나이, 사는 곳 등의 정보는 중복될 수 있음. 이 때 각각의 튜플을 구분하기 위한 기준이 되는 속성이 필요함. 그게 키

### 유일성

유일성이란, 하나의 키값으로 튜플을 유일하게 식별할 수 있는 성질을 말함. 위에서 말했듯이 여러 개의 튜플이 존재할 때 각각의 튜플을 서로 구분할 수 있는 속성이 존재해야 한다. 한마디로 각각의 튜플은 유일해야한다는 뜻.

### 최소성

최소성이란, 키를 구성하는 속성들 중 가장 최소로 필요한 속성들로만 키를 구성하는 성질을 말함. 쉽게 말해, 키를 구성하고 있는 속성들이 진짜 각 튜플을 구분하는 데 꼭 필요한 속성들로만 구성되어 있는지를 의미함.

### 1. 슈퍼키(Super Key)(유일성 O, 최소성 X)

슈퍼키는 유일성의 특성을 만족하는 속성 또는 속성들의 집합을 의미함. 키 값이 같은 튜플은 존재할 수 없음. 예를 들어 아이디가 같은 고객은 없기 때문에 아이디는 슈퍼키가 될 수 있음. 하지만 (이름, 나이, 등급) 의 경우 같은 사람은 충분히 있을 수 있기 때문에 슈퍼키로 사용할 수 없음. 하지만 (아이디, 이름, 나이, 등급)의 경우는 고객 아이디가 각 튜플을 구분할 수 있는 속성이기 때문에 슈퍼키가 될 수 있음. 이처럼 슈퍼키는 유일성은 만족하지만 최소성은 만족하지 않는 키를 의미함. 

### 2. 후보키(Candidate Key)(유일성 O, 최소성 O)

후보키는 슈퍼키 중 최소성을 만족하는, 즉 유일성과 최소성을 모두 만족하는 속성 또는 속성들의 집합. 위의 슈퍼키에서 (아이디, 이름, 나이, 등급)은 각 튜플을 유일하게 식별할 수 있으므로 유일성은 만족. 하지만 이름, 나이, 등급이 굳이 필요할까? 이 속성들은 튜플 간에 중복되는 속성값을 가지고 있고, 이 속성들이 포함되어 있지 않은 아이디만으로도 튜플의 식별에는 전혀 문제가 되지 않음. 그러므로 아이디는 최소성을 만족하며 후보키가 될 수 있음.

### 3. 기본키(Primary Key)

후보키는 한 테이블 내에서 여러 개 존재할 수 있는데, 여기에서 여러 후보키 중 하나를 선택해 사용해야 하며 여기서 선택된 키가 기본키가 됨. 하지만 모든 후보키가 기본키가 되는 것은 아니고 기본키를 위한 조건에 맞아야함.

1. NULL 값을 가질 수 있는 속성이 포함된 후보키는 기본키로 부적절
2. 값이 자주 변경될 수 있는 속성이 포함된 후보키는 기본키로 부적절
3. 단순한 후보키를 기본키로 선택

속성

- NULL 값을 가질 수 없음 (개체 무결성의 첫번째 조건)
- 기본키로 정의된 속성에는 동일한 값이 중복되어 저장될 수 없음 (개체 무결성의 두번째 조건)

### 4. 대체키(Alternate Key)

대체키는 기본키로 선택받지 못한 후보키들. 이름에서 알 수 있듯 대체키는 기본키를 대신할 수 있는 자격은 있지만 위의 3개 조건에 부합하지 않아 기본키로 선택받지 못한 키들을 의미. 보조키라는 이름으로도 불림.

### 5. 외래키(Foreign Key)

외래키는 관계를 맺고 있는 릴레이션 R1, R2에서 R1이 참조하고 있는 R2의 기본키와 같은 R1의 속성. 다시 말해 다른 릴레이션의 기본키를 그대로 참조하는 속성 또는 속성들의 집합이 외래키. 외래키는 릴레이션 간의 관계를 올바르게 표현하기 위해 필요.

속성

- 외래키로 지정되면 참조 테이블의 기본키에 없는 값은 입력이 불가능(참조 무결성 조건)

예)

- 고객(고객 아이디, 고객 이름, 나이, 등급, 직업, 적립금)
- 주문(주문번호, 주문 고객, 제품, 수량, 단가, 주문 일자)

위의 릴레이션에서 고객 릴레이션은 사이트에 가입한 고객에 대한 데이터를 가지고, 주문 릴레이션은 어떤 제품을 어떤 고객이 주문했는지에 대한 데이터를 다룸. 주문 릴레이션에는 어떤 고객이 어떤 제품을 언제 얼마나 얼마에에 대한 정보가 있음. 그리고 각 튜플을 구분할 수 있는 기본키가 있음.

여기서 주문 릴레이션은 고객의 정보를 모두 저장할 필요가 없음. 단지 고객 릴레이션에서 튜플을 구분할 수 있는 기본키가 되는 속성만을 가지고 있으면 됨. 이렇게 고객 릴레이션의 기본키를 참조하는 주문 릴레이션의 속성을 외래키라 함. 외래키는 관계를 맺은 릴레이션의 기본키를 참조하고 있으며, 이 때 중요한 점은 기본키와 기본키를 참조하는 외래키의 도메인 또한 반드시 같아야 함.

### 6. 복합키(Composite Key)

다수(2개 이상)의 속성을 사용한 키

위에서 했던 (이름, 나이, 등급) 같은 키가 복합키

### 7. 고유키(Unique Key)

중복값을 허용하지 않지만 null값이 허용되는 키, 릴레이션에서 여러 속성에 지정할 수 있음